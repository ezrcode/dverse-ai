'use client';

import React, { createContext, useContext, useEffect, useState } from 'react';

type Lang = 'es' | 'en';

const translations: Record<Lang, Record<string, string>> = {
    es: {
        // Sidebar
        sidebar_newChat: 'Nuevo chat',
        sidebar_environments: 'Entornos',
        sidebar_allEnvs: 'Todos los entornos',
        sidebar_addEnv: 'Agregar entorno',
        sidebar_conversations: 'Conversaciones',
        sidebar_settings: 'Ajustes',
        sidebar_profile: 'Perfil',
        sidebar_logout: 'Salir',
        sidebar_rename: 'Renombrar',
        sidebar_delete: 'Eliminar',
        sidebar_lang_es: 'Español',
        sidebar_lang_en: 'Inglés',
        // Environments
        env_title: 'Entornos de Dynamics 365',
        env_subtitle: 'Administra tus conexiones a Dataverse',
        env_addNew: 'Agregar Entorno',
        env_noEnvs: 'No hay entornos configurados',
        env_noEnvsDesc: 'Agrega tu primer entorno de Dynamics 365 para comenzar a analizar tu metadata.',
        env_addFirst: 'Agregar tu Primer Entorno',
        env_connected: 'Conectado',
        env_disconnected: 'Desconectado',
        env_error: 'Error',
        env_lastSync: 'Última sincronización',
        env_never: 'Nunca',
        env_testConnection: 'Probar conexión',
        env_testing: 'Probando...',
        env_edit: 'Editar',
        env_delete: 'Eliminar',
        env_confirmDelete: '¿Estás seguro de eliminar',
        env_newTitle: 'Nuevo Entorno',
        env_newSubtitle: 'Conecta tu instancia de Dynamics 365/Dataverse',
        env_editTitle: 'Editar Entorno',
        env_editSubtitle: 'Modifica la configuración de tu entorno',
        env_name: 'Nombre del entorno',
        env_namePlaceholder: 'Ej: Producción, Desarrollo',
        env_orgUrl: 'URL de la organización',
        env_orgUrlPlaceholder: 'https://tuorg.crm.dynamics.com',
        env_tenantId: 'Tenant ID',
        env_tenantIdPlaceholder: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx',
        env_clientId: 'Client ID (App Registration)',
        env_clientIdPlaceholder: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx',
        env_clientSecret: 'Client Secret',
        env_clientSecretPlaceholder: 'Tu client secret',
        env_clientSecretHint: 'Déjalo vacío para mantener el actual',
        env_description: 'Descripción (opcional)',
        env_descriptionPlaceholder: 'Notas sobre este entorno',
        env_cancel: 'Cancelar',
        env_save: 'Guardar',
        env_saving: 'Guardando...',
        env_create: 'Crear Entorno',
        env_creating: 'Creando...',
        env_back: 'Volver a entornos',
        env_loading: 'Cargando entorno...',
        env_loadingList: 'Cargando entornos...',
        // Landing
        landing_openSource: 'Open Source · Licencia MIT',
        landing_headline: 'Entiende tu Dynamics 365 en Segundos, No en Horas',
        landing_subheadline: 'Inteligencia potenciada por IA que lee tu metadata de Dataverse y responde tus preguntas en lenguaje natural. Como Cursor para código, pero para tu configuración de D365.',
        landing_startFree: 'Comenzar Gratis',
        landing_viewGithub: 'Ver en GitHub',
        landing_noCreditCard: 'Sin tarjeta de crédito · Conecta en menos de 5 minutos',
        landing_problemTitle: 'El Problema con Sistemas D365 Complejos',
        landing_problemSubtitle: 'Después de años de customizaciones, tu Dynamics 365 se convierte en una caja negra. ¿Te suena familiar?',
        landing_pain1: 'Los desarrolladores gastan 30%+ del tiempo entendiendo customizaciones existentes',
        landing_pain2: 'La documentación siempre está desactualizada o falta',
        landing_pain3: 'Miedo a romper cosas al hacer cambios',
        landing_pain4: 'Onboarding lento para nuevos miembros del equipo',
        landing_howItWorks: 'Cómo Funciona',
        landing_howItWorksSubtitle: 'Comienza en tres simples pasos',
        landing_step1Title: 'Conectar',
        landing_step1Desc: 'Vincula tu entorno de Dynamics 365 en 5 minutos con credenciales de Azure AD',
        landing_step2Title: 'Preguntar',
        landing_step2Desc: 'Consulta tu metadata en lenguaje natural - entidades, campos, workflows, lo que sea',
        landing_step3Title: 'Entender',
        landing_step3Desc: 'Obtén respuestas instantáneas con contexto, dependencias e insights accionables',
        landing_featuresTitle: 'Características Principales',
        landing_featuresSubtitle: 'Todo lo que necesitas para entender y documentar tu entorno de Dynamics 365',
        landing_feature1: 'Consultas en Lenguaje Natural',
        landing_feature1Desc: 'Haz preguntas sobre tu metadata en español o inglés',
        landing_feature2: 'Mapeo de Dependencias',
        landing_feature2Desc: 'Entiende relaciones entre entidades, campos y componentes',
        landing_feature3: 'Análisis de Impacto',
        landing_feature3Desc: 'Sabe qué se rompe antes de hacer cambios',
        landing_feature4: 'Documentación Automática',
        landing_feature4Desc: 'Genera docs técnicos desde tu configuración actual',
        landing_feature5: 'Historial de Conversaciones',
        landing_feature5Desc: 'Rastrea y revisa consultas y descubrimientos pasados',
        landing_feature6: 'Multi-Entorno',
        landing_feature6Desc: 'Conecta y analiza múltiples instancias de D365',
        landing_useCasesTitle: 'Construido para Profesionales de D365',
        landing_forDevs: 'Para Desarrolladores',
        landing_dev1: 'Onboarding 10x más rápido en nuevos proyectos',
        landing_dev2: 'Entiende customizaciones legacy',
        landing_dev3: 'Encuentra dependencias antes de cambios',
        landing_forConsultants: 'Para Consultores',
        landing_consultant1: 'Audita instancias de clientes al instante',
        landing_consultant2: 'Genera documentación técnica',
        landing_consultant3: 'Analiza múltiples entornos',
        landing_forAdmins: 'Para Administradores',
        landing_admin1: 'Sabe qué se rompe antes de cambiar',
        landing_admin2: 'Rastrea todas las customizaciones',
        landing_admin3: 'Mantén la salud del sistema',
        landing_pricingTitle: 'Precios Simples y Transparentes',
        landing_pricingSubtitle: 'Comienza gratis, actualiza cuando necesites más',
        landing_free: 'Gratis',
        landing_pro: 'Pro',
        landing_enterprise: 'Empresarial',
        landing_month: '/mes',
        landing_custom: 'Personalizado',
        landing_queriesMonth: 'consultas/mes',
        landing_environments: 'entornos',
        landing_history: 'historial',
        landing_unlimited: 'Ilimitado',
        landing_byok: 'BYOK (Trae tu propia Key)',
        landing_export: 'Funciones de exportación',
        landing_sso: 'SSO + Soporte Prioritario',
        landing_api: 'Acceso API',
        landing_getStartedFree: 'Comenzar Gratis',
        landing_startProTrial: 'Iniciar Prueba Pro',
        landing_contactUs: 'Contáctanos',
        landing_mostPopular: 'Más Popular',
        landing_techTitle: 'Construido con Tecnología Moderna',
        landing_techSubtitle: 'Open source y construido sobre tecnologías probadas',
        landing_starOnGithub: 'Dar estrella en GitHub',
        landing_finalCta: 'Comienza a Analizar tu Dataverse Hoy',
        landing_finalCtaSubtitle: 'Conecta tu entorno de Dynamics 365 en menos de 5 minutos. Sin tarjeta de crédito.',
        landing_login: 'Iniciar Sesión',
    },
    en: {
        // Sidebar
        sidebar_newChat: 'New Chat',
        sidebar_environments: 'Environments',
        sidebar_allEnvs: 'All Environments',
        sidebar_addEnv: 'Add Environment',
        sidebar_conversations: 'Conversations',
        sidebar_settings: 'Settings',
        sidebar_profile: 'Profile',
        sidebar_logout: 'Logout',
        sidebar_rename: 'Rename',
        sidebar_delete: 'Delete',
        sidebar_lang_es: 'Spanish',
        sidebar_lang_en: 'English',
        // Environments
        env_title: 'Dynamics 365 Environments',
        env_subtitle: 'Manage your Dataverse connections',
        env_addNew: 'Add Environment',
        env_noEnvs: 'No environments configured',
        env_noEnvsDesc: 'Add your first Dynamics 365 environment to start analyzing your metadata.',
        env_addFirst: 'Add Your First Environment',
        env_connected: 'Connected',
        env_disconnected: 'Disconnected',
        env_error: 'Error',
        env_lastSync: 'Last sync',
        env_never: 'Never',
        env_testConnection: 'Test connection',
        env_testing: 'Testing...',
        env_edit: 'Edit',
        env_delete: 'Delete',
        env_confirmDelete: 'Are you sure you want to delete',
        env_newTitle: 'New Environment',
        env_newSubtitle: 'Connect your Dynamics 365/Dataverse instance',
        env_editTitle: 'Edit Environment',
        env_editSubtitle: 'Modify your environment configuration',
        env_name: 'Environment name',
        env_namePlaceholder: 'E.g.: Production, Development',
        env_orgUrl: 'Organization URL',
        env_orgUrlPlaceholder: 'https://yourorg.crm.dynamics.com',
        env_tenantId: 'Tenant ID',
        env_tenantIdPlaceholder: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx',
        env_clientId: 'Client ID (App Registration)',
        env_clientIdPlaceholder: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx',
        env_clientSecret: 'Client Secret',
        env_clientSecretPlaceholder: 'Your client secret',
        env_clientSecretHint: 'Leave empty to keep current',
        env_description: 'Description (optional)',
        env_descriptionPlaceholder: 'Notes about this environment',
        env_cancel: 'Cancel',
        env_save: 'Save',
        env_saving: 'Saving...',
        env_create: 'Create Environment',
        env_creating: 'Creating...',
        env_back: 'Back to environments',
        env_loading: 'Loading environment...',
        env_loadingList: 'Loading environments...',
        // Landing
        landing_openSource: 'Open Source · MIT License',
        landing_headline: 'Understand Your Dynamics 365 in Seconds, Not Hours',
        landing_subheadline: 'AI-powered intelligence that reads your Dataverse metadata and answers your questions in natural language. Like Cursor for code, but for your D365 configuration.',
        landing_startFree: 'Start Free Trial',
        landing_viewGithub: 'View on GitHub',
        landing_noCreditCard: 'No credit card required · Connect in under 5 minutes',
        landing_problemTitle: 'The Problem with Complex D365 Systems',
        landing_problemSubtitle: 'After years of customizations, your Dynamics 365 becomes a black box. Sound familiar?',
        landing_pain1: 'Developers spend 30%+ of time understanding existing customizations',
        landing_pain2: 'Documentation is always outdated or missing',
        landing_pain3: 'Fear of breaking things when making changes',
        landing_pain4: 'Slow onboarding for new team members',
        landing_howItWorks: 'How It Works',
        landing_howItWorksSubtitle: 'Get started in three simple steps',
        landing_step1Title: 'Connect',
        landing_step1Desc: 'Link your Dynamics 365 environment in 5 minutes with Azure AD credentials',
        landing_step2Title: 'Ask',
        landing_step2Desc: 'Query your metadata in natural language - entities, fields, workflows, anything',
        landing_step3Title: 'Understand',
        landing_step3Desc: 'Get instant answers with context, dependencies, and actionable insights',
        landing_featuresTitle: 'Key Features',
        landing_featuresSubtitle: 'Everything you need to understand and document your Dynamics 365 environment',
        landing_feature1: 'Natural Language Queries',
        landing_feature1Desc: 'Ask questions about your metadata in plain English or Spanish',
        landing_feature2: 'Dependency Mapping',
        landing_feature2Desc: 'Understand relationships between entities, fields, and components',
        landing_feature3: 'Impact Analysis',
        landing_feature3Desc: 'Know what breaks before you make changes',
        landing_feature4: 'Auto Documentation',
        landing_feature4Desc: 'Generate technical docs from your actual configuration',
        landing_feature5: 'Conversation History',
        landing_feature5Desc: 'Track and revisit past queries and discoveries',
        landing_feature6: 'Multi-Environment',
        landing_feature6Desc: 'Connect and analyze multiple D365 instances',
        landing_useCasesTitle: 'Built for D365 Professionals',
        landing_forDevs: 'For Developers',
        landing_dev1: 'Onboard to new projects 10x faster',
        landing_dev2: 'Understand legacy customizations',
        landing_dev3: 'Find dependencies before changes',
        landing_forConsultants: 'For Consultants',
        landing_consultant1: 'Audit client instances instantly',
        landing_consultant2: 'Generate technical documentation',
        landing_consultant3: 'Analyze multiple environments',
        landing_forAdmins: 'For Admins',
        landing_admin1: 'Know what breaks before you change',
        landing_admin2: 'Track all customizations',
        landing_admin3: 'Maintain system health',
        landing_pricingTitle: 'Simple, Transparent Pricing',
        landing_pricingSubtitle: 'Start free, upgrade when you need more',
        landing_free: 'Free',
        landing_pro: 'Pro',
        landing_enterprise: 'Enterprise',
        landing_month: '/month',
        landing_custom: 'Custom',
        landing_queriesMonth: 'queries/month',
        landing_environments: 'environments',
        landing_history: 'history',
        landing_unlimited: 'Unlimited',
        landing_byok: 'BYOK (Bring Your Own Key)',
        landing_export: 'Export features',
        landing_sso: 'SSO + Priority Support',
        landing_api: 'API Access',
        landing_getStartedFree: 'Get Started Free',
        landing_startProTrial: 'Start Pro Trial',
        landing_contactUs: 'Contact Us',
        landing_mostPopular: 'Most Popular',
        landing_techTitle: 'Built with Modern Tech',
        landing_techSubtitle: 'Open source and built on proven technologies',
        landing_starOnGithub: 'Star on GitHub',
        landing_finalCta: 'Start Analyzing Your Dataverse Today',
        landing_finalCtaSubtitle: 'Connect your Dynamics 365 environment in under 5 minutes. No credit card required.',
        landing_login: 'Login',
    },
};

interface I18nContextValue {
    lang: Lang;
    setLang: (lang: Lang) => void;
    t: (key: string) => string;
}

const I18nContext = createContext<I18nContextValue>({
    lang: 'es',
    setLang: () => {},
    t: (k) => k,
});

export function I18nProvider({ children }: { children: React.ReactNode }) {
    const [lang, setLangState] = useState<Lang>('es');

    useEffect(() => {
        const stored = typeof window !== 'undefined' ? localStorage.getItem('lang') : null;
        if (stored === 'en' || stored === 'es') {
            setLangState(stored);
        }
    }, []);

    const setLang = (l: Lang) => {
        setLangState(l);
        if (typeof window !== 'undefined') {
            localStorage.setItem('lang', l);
        }
    };

    const t = (key: string) => translations[lang][key] || key;

    return (
        <I18nContext.Provider value={{ lang, setLang, t }}>
            {children}
        </I18nContext.Provider>
    );
}

export function useI18n() {
    return useContext(I18nContext);
}

